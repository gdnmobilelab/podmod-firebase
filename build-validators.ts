import * as TJS from "typescript-json-schema";
import * as path from "path";
import * as fs from "fs";

const program = TJS.getProgramFromFiles(
  [path.join(__dirname, "src", "interface", "fcm-requests.ts"), path.join(__dirname, "src", "interface", "env.ts")],
  null,
  null
);

const generator = TJS.buildGenerator(program, {
  required: true
});

let interfaces = ["FCMMessage", "FCMTokenMessage", "FCMTopicMessage", "EnvironmentVariables"];

let result = generator.getSchemaForSymbols(interfaces);

let FCMMessage = generator.getSchemaForSymbol("FCMMessage");
let FCMTokenMessage = generator.getSchemaForSymbol("FCMTokenMessage");
let FCMTopicMessage = generator.getSchemaForSymbol("FCMTopicMessage");

fs.writeFileSync(
  path.join(__dirname, "validators", "validators.ts"),
  `// This file is automatically generated by "npm run build-interface-validation". Do not edit it directly.
  
  export default ` + JSON.stringify(result, null, 2)
);
